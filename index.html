<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œæŸ»ä¸­...</title>
<style>
  :root { --card-w: 760px; }
  * { box-sizing: border-box }
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
    margin: 0; padding: 0 1rem;
    background: linear-gradient(135deg, #f8fbff, #fefefe);
    display:flex; align-items:center; justify-content:center; min-height:100vh;
  }
  .card {
    width:100%; max-width:var(--card-w);
    background:#fff; border:1px solid #e8e8e8; border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
    padding:2rem 1.5rem;
    text-align:center;
    animation: fadeIn .4s ease-out;
  }
  h1 { font-size:1.4rem; margin-bottom:.5rem; }
  .hint { color:#666; margin-bottom:1rem; }
  .spinner {
    width:50px; height:50px;
    border:5px solid #e4e4e4;
    border-top-color:#0078ff;
    border-radius:50%;
    margin:1rem auto;
    animation: spin 1s linear infinite;
  }
  .bar-wrap {
    height:12px; background:#eee; border-radius:6px;
    overflow:hidden; margin-top:1rem;
  }
  .bar {
    height:100%; width:0%;
    background:linear-gradient(90deg,#0078ff,#00b4ff);
    animation: load 2s linear forwards;
  }
  .status { color:#444; margin-top:1rem; }
  a { color:#0078ff; text-decoration:none; }

  @keyframes spin { to { transform:rotate(360deg); } }
  @keyframes load { from{width:0%} to{width:100%} }
  @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
</style>
<body>
  <div class="card">
    <h1>ğŸ” ã‚µã‚¤ãƒˆã®å®‰å…¨æ€§ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...</h1>
    <p class="hint">å®‰å…¨æ€§ã‚’æ¤œæŸ»ã—ã¦ã„ã¾ã™ã€‚<br>2ç§’å¾Œã«è‡ªå‹•çš„ã«ç›®çš„ã®ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ã€‚</p>
    <div class="spinner"></div>
    <div class="bar-wrap"><div class="bar"></div></div>
    <p id="status" class="status">URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è§£æä¸­...</p>
    <p id="fallback" style="display:none"><a id="fallbackLink" href="#">ã“ã¡ã‚‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç§»å‹•</a></p>
  </div>

<script>
(function(){
  const DELAY_MS = 2000; // 2ç§’å¾…ã£ã¦ã‹ã‚‰é·ç§»

  function getEncodedParam() {
    const sp = new URLSearchParams(location.search);
    let v = sp.get('url');
    if (v) return v;
    const m = location.pathname.match(/index\.html&url=([^/?#]+)/i);
    if (m && m[1]) return decodeURIComponent(m[1]);
    return null;
  }

  function b64DecodeUtf8(b64) {
    b64 = b64.replace(/-/g,'+').replace(/_/g,'/');
    while (b64.length % 4 !== 0) b64 += '=';
    const bin = atob(b64);
    const bytes = new Uint8Array(bin.length);
    for (let i=0;i<bin.length;i++) bytes[i] = bin.charCodeAt(i);
    return new TextDecoder().decode(bytes);
  }

  function normalizeToHttpUrl(s) {
    try {
      if (/^\/\//.test(s)) s = 'https:' + s;
      if (!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(s)) s = 'https://' + s;
      const u = new URL(s);
      if (u.protocol === 'http:' || u.protocol === 'https:') return u.href;
      return null;
    } catch { return null; }
  }

  function setStatus(msg){ document.getElementById('status').textContent = msg; }

  const enc = getEncodedParam();
  if(!enc){ setStatus('URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä¾‹ï¼š?url=Base64'); return; }

  let decoded;
  try{ decoded = b64DecodeUtf8(enc.trim()); }
  catch{ setStatus('Base64ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); return; }

  const target = normalizeToHttpUrl(decoded);
  if(!target){ setStatus('ä¸æ­£ãªURLã€ã¾ãŸã¯http/httpsã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚'); return; }

  setStatus('å®‰å…¨æ€§ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ã¾ã‚‚ãªãç§»å‹•ã—ã¾ã™...');
  const link = document.getElementById('fallbackLink');
  link.href = target;
  document.getElementById('fallback').style.display = 'block';

  setTimeout(()=>{ location.replace(target); }, DELAY_MS);
})();
</script>
</body>
</html>
