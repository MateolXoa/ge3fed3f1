<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œæŸ»ä¸­â€¦</title>
<style>
  :root { --card-w: 760px; --delay-ms: 800ms; }
  * { box-sizing: border-box }
  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans JP", sans-serif;
    margin: 0; padding: 0 1rem; line-height: 1.7; color: #222;
    display:flex; min-height:100svh; align-items:center; justify-content:center;
    background: radial-gradient(1200px 600px at 20% -10%, #f7faff, transparent 60%),
                radial-gradient(1000px 500px at 110% 90%, #f8fff7, transparent 60%),
                #ffffff;
  }
  .card{
    width:100%; max-width: var(--card-w);
    border: 1px solid #e8e8e8; border-radius: 16px; padding: 28px 22px;
    box-shadow: 0 8px 30px rgba(0,0,0,.06); background:#fff;
    animation: pop .35s ease-out both;
  }
  h1{font-size:1.35rem; margin: 0 0 .4rem 0}
  .hint{color:#666; margin:.2rem 0 .8rem}
  code{background:#f6f6f6;border:1px solid #eee;border-radius:6px;padding:.05em .45em}

  /* Spinner */
  .row{display:flex; gap:16px; align-items:center; margin:.5rem 0 .8rem}
  .spinner{
    width:30px; height:30px; border-radius:50%;
    border:3px solid rgba(0,0,0,.08);
    border-top-color: rgba(0,0,0,.55);
    animation: spin 0.9s linear infinite;
  }

  /* Animated progress bar */
  .bar-wrap{height:12px; border-radius:999px; background:#f1f1f1; overflow:hidden; border:1px solid #eee}
  .bar{
    width:0%; height:100%;
    background: linear-gradient(90deg, rgba(0,0,0,.2), rgba(0,0,0,.45), rgba(0,0,0,.2));
    background-size: 200% 100%;
    animation: sweep var(--delay-ms) ease-out forwards, shine 1.2s linear infinite;
  }

  /* Fading status text */
  #status{color:#444; margin-top:.6rem}
  .small{font-size:.92rem}

  @keyframes spin { to { transform: rotate(360deg) } }
  @keyframes sweep { from { width: 0% } to { width: 100% } }
  @keyframes shine { from { background-position: 200% 0 } to { background-position: -200% 0 } }
  @keyframes pop { from { transform: translateY(8px); opacity:0 } to { transform:none; opacity:1 } }

  .muted{color:#8a8a8a}
</style>
<body>
  <main class="card" role="main" aria-live="polite">
    <h1>ğŸ” ã‚µã‚¤ãƒˆã®å®‰å…¨æ€§ã‚’ç¢ºèªã—ã¦ã„ã¾ã™â€¦</h1>
    <p class="hint">æ•°ç§’ä»¥å†…ã«è‡ªå‹•çš„ã«ç›®çš„ã®ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ã€‚ç§»å‹•ã—ãªã„å ´åˆã¯ã€URL ãŒ <code>index.html?url=Base64</code>ï¼ˆäº’æ›ï¼š<code>index.html&amp;url=Base64</code>ï¼‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>

    <div class="row">
      <div class="spinner" aria-hidden="true"></div>
      <div style="flex:1">
        <div class="bar-wrap"><div class="bar"></div></div>
      </div>
    </div>

    <p id="status" class="small">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è§£æã—ã¦ã„ã¾ã™â€¦</p>
    <p id="fallback" class="small muted" style="display:none">
      è‡ªå‹•ã§ç§»å‹•ã—ãªã„å ´åˆã¯ <a id="fallbackLink" href="#">ã“ã¡ã‚‰</a> ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
    </p>
  </main>

<script>
(function () {
  // ======= è¨­å®šï¼ˆã‚¢ãƒ‹ãƒ¡è¡¨ç¤ºã®ãŸã‚ã®çŸ­ã„é…å»¶ï¼‰=======
  const DELAY_MS = 800; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã›ã‚‹å¾…æ©Ÿæ™‚é–“ã€‚ä¸è¦ãªã‚‰ 0 ã«ã€‚

  // --- 1) url ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—ï¼ˆ?url= ã¨ index.html&url= ã®ä¸¡å¯¾å¿œï¼‰ ---
  function getEncodedParam() {
    const sp = new URLSearchParams(location.search);
    let v = sp.get('url');
    if (v) return v;

    const m = location.pathname.match(/index\.html&url=([^/?#]+)/i);
    if (m && m[1]) return decodeURIComponent(m[1]);
    return null;
  }

  // --- 2) Base64 ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆURL-safeå¯¾å¿œã€UTF-8å¯¾å¿œï¼‰ ---
  function b64DecodeUtf8(b64) {
    b64 = b64.replace(/-/g, '+').replace(/_/g, '/');
    while (b64.length % 4 !== 0) b64 += '=';
    const bin = atob(b64);
    const bytes = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
    return new TextDecoder('utf-8').decode(bytes);
  }

  // --- 3) http/https ã®ã¿è¨±å¯ã€ã‚¹ã‚­ãƒ¼ãƒè£œæ­£ ---
  function normalizeToHttpUrl(s) {
    try {
      if (/^\/\//.test(s)) s = 'https:' + s;
      if (!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(s)) s = 'https://' + s;
      const u = new URL(s);
      if (u.protocol === 'http:' || u.protocol === 'https:') return u.href;
      return null;
    } catch { return null; }
  }

  function setStatus(msg) { document.getElementById('status').textContent = msg; }

  const enc = getEncodedParam();
  if (!enc) {
    setStatus('URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä¾‹ï¼š/index.html?url=aHR0cHM6Ly9leGFtcGxlLmNvbS8=');
    return;
  }

  let decoded;
  try {
    decoded = b64DecodeUtf8(enc.trim());
  } catch {
    setStatus('Base64 ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URL-safeï¼ˆ-/_ãƒ»ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°çœç•¥ï¼‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚');
    return;
  }

  const target = normalizeToHttpUrl(decoded);
  if (!target) {
    setStatus('é·ç§»å…ˆ URL ã®å½¢å¼ãŒä¸æ­£ã€ã¾ãŸã¯è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ï¼ˆhttp/https ã®ã¿ï¼‰ã€‚');
    return;
  }

  setStatus('å®‰å…¨æ€§ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ã¾ã‚‚ãªãç§»å‹•ã—ã¾ã™ï¼š' + target);

  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼ˆè‡ªå‹•é·ç§»ã§ããªã„ç’°å¢ƒå‘ã‘ï¼‰
  const a = document.getElementById('fallbackLink');
  a.href = target;
  document.getElementById('fallback').style.display = '';

  // å°‘ã—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã›ã¦ã‹ã‚‰é·ç§»
  setTimeout(() => {
    try { location.replace(target); }
    catch { location.href = target; }
  }, DELAY_MS);
})();
</script>
</body>
</html>
