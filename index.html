<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è·³è½¬ä¸­...</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:720px;margin:12vh auto;padding:0 1rem;line-height:1.65}
  code{background:#f6f6f6;border:1px solid #eee;border-radius:6px;padding:0 .4em}
  .hint{color:#666}
</style>
<body>
  <h1>ğŸ” æ­£åœ¨è·³è½¬</h1>
  <p class="hint">å¦‚æœæ²¡æœ‰è‡ªåŠ¨è·³è½¬ï¼Œè¯·æ£€æŸ¥ä½ çš„é“¾æ¥æ˜¯å¦ä¸º <code>index.html?url=Base64</code>ï¼ˆæˆ–å…¼å®¹çš„ <code>index.html&amp;url=Base64</code>ï¼‰ã€‚</p>
  <p id="status" class="hint">è§£æå‚æ•°ä¸­â€¦</p>

<script>
(function () {
  // 1) å–å‡º ?url=xxxxxï¼›åŒæ—¶å…¼å®¹ /index.html&url=xxxxx çš„éå¸¸è§„å†™æ³•
  function getEncodedParam() {
    const sp = new URLSearchParams(location.search);
    let v = sp.get('url');
    if (v) return v;

    // å…¼å®¹ï¼šè·¯å¾„é‡Œå‡ºç° index.html&url=xxxxx
    const m = location.pathname.match(/index\.html&url=([^/?#]+)/i);
    if (m && m[1]) return decodeURIComponent(m[1]);

    return null;
  }

  // 2) Base64 è§£ç ï¼šæ”¯æŒæ ‡å‡†å’Œ URL-safeï¼ˆ- _ï¼‰ï¼Œè‡ªåŠ¨è¡¥é½ padding
  function b64DecodeUtf8(b64) {
    // URL-safe -> æ ‡å‡†
    b64 = b64.replace(/-/g, '+').replace(/_/g, '/');
    // è¡¥é½åˆ° 4 çš„å€æ•°
    while (b64.length % 4 !== 0) b64 += '=';
    // atob -> bytes
    const bin = atob(b64);
    const bytes = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
    // UTF-8 è§£ç 
    return new TextDecoder('utf-8').decode(bytes);
  }

  // 3) åªå…è®¸ http/httpsï¼Œè¡¥æ•‘å¯èƒ½çš„ //example.com æˆ–ç¼ºåè®®æƒ…å†µ
  function normalizeToHttpUrl(s) {
    try {
      // å¦‚æœæ˜¯ //example.com è¿™ç§ schema-less
      if (/^\/\//.test(s)) s = 'https:' + s;
      // å¦‚æœç¼ºåè®®ä½†åƒ domain/pathï¼Œåˆ™é»˜è®¤ https
      if (!/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(s)) s = 'https://' + s;

      const u = new URL(s);
      if (u.protocol === 'http:' || u.protocol === 'https:') return u.href;
      return null; // é http(s) æ‹’ç»
    } catch { return null; }
  }

  function setStatus(msg) {
    document.getElementById('status').textContent = msg;
  }

  const enc = getEncodedParam();
  if (!enc) {
    setStatus('ç¼ºå°‘ url å‚æ•°ã€‚ä¾‹å¦‚ï¼š/index.html?url=aHR0cHM6Ly9leGFtcGxlLmNvbS8=');
    return;
  }

  let decoded;
  try {
    decoded = b64DecodeUtf8(enc.trim());
  } catch (e) {
    setStatus('Base64 è§£ç å¤±è´¥ï¼Œè¯·ç¡®è®¤ç¼–ç æ˜¯å¦æ­£ç¡®ï¼ˆæ”¯æŒ URL-safe å˜ä½“ï¼‰ã€‚');
    return;
  }

  const target = normalizeToHttpUrl(decoded);
  if (!target) {
    setStatus('ç›®æ ‡é“¾æ¥åè®®ä¸è¢«å…è®¸æˆ–æ ¼å¼é”™è¯¯ï¼Œä»…å…è®¸ http(s)ã€‚');
    return;
  }

  setStatus('å°†è·³è½¬åˆ°ï¼š' + target);
  // ç”¨ replace é¿å…äº§ç”Ÿè¿”å›å†å²
  location.replace(target);
})();
</script>
</body>
</html>
